# Build stage - use debian-based image to avoid musl rollup issues
FROM node:22-bullseye AS build

WORKDIR /app

# Copy package files first for better caching
COPY angular-recipe-app/package*.json ./

# Install dependencies
RUN npm ci

# Copy source code
COPY angular-recipe-app/ .

# Install Angular CLI globally
RUN npm install -g @angular/cli --no-audit --no-fund

# Build the application (remove duplicate build command)
RUN npm run build

# EXPOSE 4200
# CMD ["npm", "start"]


EXPOSE 4200
CMD [ "npm", "start" ]
# CMD [ "npm", "ci" ]
# CMD [ "sleep", "infinity" ]

# RUN sleep infinity

# # Production stage
# FROM nginx:alpine

# # Copy the built application
# COPY --from=build /app/dist/receipt-app/browser /usr/share/nginx/html

# # Copy nginx configuration
# COPY recipe-app/nginx.conf /etc/nginx/nginx.conf

# # Expose port 80
# EXPOSE 80

# CMD ["nginx", "-g", "daemon off;"]
